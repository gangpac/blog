{%-comment-%}
lists projects as section cards given a projects hash

inputs:                   none
dependencies:
  projects                the projects to render
  site.projects           used as the default if `projects` isn't available already
  site.static_files       lookup and make sure a placeholder.png file exists
  site.show.authors       used to determine whether to show authors
  site.show.project_authors used to determine whether to show authors
  site.people             lookup authors in the people array
  site.title              use as the author, as a last resort
local:
  projects                default to site.projects if not already provided
  published_projects      projects filtered for `published==true`
  placeholder             placeholder.png file to use in case no other page image is available
  auth                    the author's handle, used for unpublished authors in place of their name
  author                  the looked-up author in site.people
{%-endcomment-%}

{%-if page.layout == "page"-%}
  {%-assign projects          = site.projects-%}
{%-endif-%}
{%-assign published_projects  = projects          | where: 'published', true-%}

      {%-if published_projects != empty %}
        {%-for project in published_projects %}
          {%-if project.published %}
            <article itemid="{{-project.url|absolute_url-}}" class="h-entry project-card row gtr-50 gtr-uniform" itemscope itemtype="http://schema.org/Article">
            {% if project.images-%}
              <div class="col-4 col-12-small">
                <figure>
                  <a href="{{-project.url-}}" class="image fit" title="Learn more about '{{-project.title-}}'">
                    {% include item_image.html-%}
                  </a>
                </figure>
                <div class="snug smaller categories">{%-include categories.html %}</div>
              {%-if project.series %}
                <div class="snug series" title="This project is part of a series">{{ project.series | replace: '-',' ' |  split: " " | join: "-----" | camelcase | split: "-----" | join: " "-}}</div>
              {%-endif %}
              </div>
            {%-endif %}
              <div class="col-8 col-12-small">
                {%-assign modified_date = project.modified_date | default: project.last_modified_at-%}
              {%-if modified_date-%}
                {% include date_modified.html item_date=modified_date lead_in='last modified: '-%}
              {%-endif %}
                <header class="tight">
                  <span class="header-aside">{% include item_date.html %}</span>
                  <h3><a href="{{-project.url-}}" itemprop="name" class="u-url p-name" title="Learn more about '{{-project.title-}}'">{{-project.title-}}</a></h3>
                  <p class="subtitle p-subtitle" itemprop="alternativeHeadline">{{-project.subtitle-}}</p>
                  {%-if site.show.project_authors and site.show.authors and project.author or project.location-%}
                  <p class="byline">
                  {%-if site.show.authors %}
                    {%-for auth in project.author-%}
                      {%-assign author = site.people | find: 'handle', auth-%}
                      {%-if author.published and author.url-%}
                        <a href="{{-author.url-}}" rel="author" itemprop="author" class="u-author p-author" title="Read {{ author.name | split: ' ' | first-}}'s bio">{{-author.name-}}</a>
                      {%-elsif author.published-%}
                        <span itemprop="author" class="p-author">{{-author.name-}}</span>
                      {%-else-%}
                        <span itemprop="author" class="p-author">{{-auth-}}</span>
                      {%-endif-%}
                      {%-unless forloop.last %}, {% endunless-%}
                    {%-else-%}
                      <span itemprop="author" class="p-author">{{-site.title-}}</span>
                    {%-endfor-%}
                    {%-if project.location and project.author or site.title-%}{{-"&nbsp; | &nbsp;"-}}{%-endif-%}
                  {%-endif %}
                    {%-if project.location %}
                    <span class="p-location" itemprop="location" title="Post location">{{-project.location-}}</span>
                    {%-endif %}
                  </p>
                  {%-endif-%}
                </header>
                {% if include.summary or project.summary or project.excerpt-%}
                <div class="summary p-summary" itemprop="abstract">
                {{-include.summary | default: project.summary | default: project.excerpt | markdownify-}}
                </div>
                {%-endif %}
                {%-include tags.html %}
              </div>
            </article>
            <hr class="major"/>
          {% endif %}
        {% endfor %}
      {% else %}
            <h2>Oof!</h2>
            <p>It looks like there aren't any published projects here yet. Might you bug the site owner to create one for your look-see?</p>
      {% endif %}